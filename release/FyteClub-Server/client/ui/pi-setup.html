<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Raspberry Pi Setup - StallionSync</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .pi-discovery {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .pi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #333;
            border-radius: 4px;
            margin: 10px 0;
        }
        .pi-info {
            flex: 1;
        }
        .pi-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .pi-status.online { background: #4caf50; color: white; }
        .pi-status.offline { background: #f44336; color: white; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .test-item {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .test-item.passed { border-left: 4px solid #4caf50; }
        .test-item.failed { border-left: 4px solid #f44336; }
        .test-item.pending { border-left: 4px solid #ff9800; }
        .port-forwarding-guide {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .router-selector {
            margin: 15px 0;
        }
        .install-command {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #ff6b35;
            margin: 15px 0;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b35;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêé StallionSync Raspberry Pi Setup</h1>
        </header>

        <div class="setup-wizard">
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 25%"></div>
            </div>

            <!-- Step 1: Installation -->
            <div class="step active" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h2>Install StallionSync on Raspberry Pi</h2>
                </div>
                
                <p>Run this command on your Raspberry Pi to install StallionSync:</p>
                
                <div class="install-command">
                    <button class="copy-btn" onclick="copyInstallCommand()">Copy</button>
                    <code id="install-cmd">curl -sSL https://raw.githubusercontent.com/stallionsync/stallionsync/main/scripts/install-pi.sh | bash</code>
                </div>

                <p><strong>What this does:</strong></p>
                <ul>
                    <li>Installs Node.js and dependencies</li>
                    <li>Creates stallionsync user and service</li>
                    <li>Configures firewall (port 3000)</li>
                    <li>Generates API key</li>
                    <li>Starts StallionSync server</li>
                </ul>

                <div class="actions">
                    <button class="btn primary" onclick="nextStep()">Installation Complete</button>
                    <button class="btn secondary" onclick="window.close()">Cancel</button>
                </div>
            </div>

            <!-- Step 2: Discovery -->
            <div class="step" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h2>Find Your Raspberry Pi</h2>
                </div>
                
                <p>Scanning your network for StallionSync servers...</p>
                
                <div class="pi-discovery" id="pi-discovery">
                    <p>üîç Scanning network...</p>
                </div>

                <div class="form-group">
                    <label>Manual IP Address</label>
                    <input type="text" id="manual-ip" placeholder="192.168.1.100">
                    <button class="btn secondary" onclick="testManualIP()">Test</button>
                </div>

                <div class="actions">
                    <button class="btn secondary" onclick="prevStep()">Back</button>
                    <button class="btn primary" onclick="scanNetwork()">Scan Again</button>
                    <button class="btn primary" id="continue-tests" onclick="nextStep()" style="display: none;">Continue</button>
                </div>
            </div>

            <!-- Step 3: Connection Tests -->
            <div class="step" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h2>Test Connection</h2>
                </div>
                
                <p>Testing connection to your Raspberry Pi...</p>
                
                <div class="test-grid" id="test-grid">
                    <div class="test-item pending">
                        <h4>üèì Ping Test</h4>
                        <p>Basic network connectivity</p>
                    </div>
                    <div class="test-item pending">
                        <h4>üåê HTTP Connection</h4>
                        <p>Web server responding</p>
                    </div>
                    <div class="test-item pending">
                        <h4>üîß API Health</h4>
                        <p>StallionSync API working</p>
                    </div>
                    <div class="test-item pending">
                        <h4>üîë Authentication</h4>
                        <p>API key validation</p>
                    </div>
                    <div class="test-item pending">
                        <h4>üåç Port Forwarding</h4>
                        <p>External access (optional)</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="api-key" placeholder="Enter API key from Pi installation">
                </div>

                <div class="actions">
                    <button class="btn secondary" onclick="prevStep()">Back</button>
                    <button class="btn primary" onclick="runTests()">Run Tests</button>
                    <button class="btn primary" id="continue-port" onclick="nextStep()" style="display: none;">Continue</button>
                </div>
            </div>

            <!-- Step 4: Port Forwarding -->
            <div class="step" id="step4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <h2>Configure Port Forwarding</h2>
                </div>
                
                <p>To allow external access, configure port forwarding on your router:</p>
                
                <div class="router-selector">
                    <label>Router Brand</label>
                    <select id="router-brand" onchange="updateRouterInstructions()">
                        <option value="generic">Generic Router</option>
                        <option value="netgear">Netgear</option>
                        <option value="linksys">Linksys</option>
                        <option value="asus">ASUS</option>
                        <option value="tplink">TP-Link</option>
                    </select>
                </div>

                <div class="port-forwarding-guide" id="port-guide">
                    <h3>Generic Router Instructions</h3>
                    <ol id="port-instructions">
                        <li>Loading instructions...</li>
                    </ol>
                </div>

                <div class="actions">
                    <button class="btn secondary" onclick="prevStep()">Back</button>
                    <button class="btn secondary" onclick="testPortForwarding()">Test Port Forwarding</button>
                    <button class="btn primary" onclick="nextStep()">Skip (Local Only)</button>
                </div>
            </div>

            <!-- Step 5: Complete -->
            <div class="step" id="step5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <h2>Setup Complete!</h2>
                </div>
                
                <p>üéâ Your Raspberry Pi is now configured for StallionSync!</p>
                
                <div class="stat-card">
                    <h3>Connection Details</h3>
                    <p><strong>Pi IP:</strong> <span id="final-pi-ip">Loading...</span></p>
                    <p><strong>API Endpoint:</strong> <span id="final-pi-endpoint">Loading...</span></p>
                    <p><strong>Port:</strong> 3000</p>
                    <p><strong>Status:</strong> <span id="final-pi-status">Online</span></p>
                </div>

                <p>These settings have been saved to StallionSync.</p>

                <div class="actions">
                    <button class="btn primary" onclick="finishSetup()">Launch StallionSync</button>
                </div>
            </div>
        </div>
    </div>

    <script src="pi-setup.js"></script>
</body>
</html>